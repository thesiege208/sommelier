<!DOCTYPE html>
<html lang="en">
<html ng-app="recipeAssistant">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>SOMMELIER</title>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link href="css/index.css" rel="stylesheet">
        <link href="css/results.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Gruppo" rel="stylesheet">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            $(function () {
                var $landing = $("#landing"),
                    $actual  = $("#actual");
                $landing.on("click", function (){                
                    $(this).addClass("clicked");
                })
             });

            $(document).ready(function(){
                var list = document.getElementById('cart');
                list.setAttribute('data-toggle', 'modal');
                list.setAttribute('data-target', '#listModal');

                $.get("https://kzhe8vy1yd.execute-api.us-east-1.amazonaws.com/prod/TaskWS?TableName=WineFoodShopping", function(data){
                    var db = JSON.stringify(data);

                    var parse = JSON.parse(db);
                    var recipeList = parse.Items;

                    var sh_list = document.getElementById('sh_list');
                    for (i = 0; i < recipeList.length; i++) {

                        var label= document.createElement("label");
                        var item = document.createTextNode(" " + recipeList[i].Item);
                        var checkbox = document.createElement('input');
                        checkbox.setAttribute('type', 'checkbox');
                        label.appendChild(checkbox);
                        label.appendChild(item);
                        document.getElementById('sh_list').appendChild(label);
                        document.getElementById('sh_list').appendChild(document.createElement("br"));
                    }
                });

                var button = document.getElementById('button');
                button.setAttribute('data-toggle', 'modal');
                button.setAttribute('data-target', '#resModal');

                // Hardcoded
                var elements = document.getElementsByTagName('label');
                var animationSpeed = 500;
                elements[0].addEventListener('click', function() {
                    if ( $('#rc0').height() != 148) {
                        console.log($('#rc0').height());
                        $('#rc0').animate({ height: 150 }, animationSpeed );
                        $('#result-img-container0').animate({ height: 150 }, animationSpeed );
                    } else {
                        console.log("hello");
                        $('#rc0').animate({ height: 225 }, animationSpeed );
                        $('#result-img-container0').animate({ height: 224 }, animationSpeed );
                    }
                });
                elements[1].addEventListener('click', function() {
                    if ( $('#rc1').height() != 148) {
                        console.log($('#rc1').height());
                        $('#rc1').animate({ height: 150 }, animationSpeed );
                        $('#result-img-container1').animate({ height: 150 }, animationSpeed );
                    } else {
                        console.log("hello");
                        $('#rc1').animate({ height: 225 }, animationSpeed );
                        $('#result-img-container1').animate({ height: 224 }, animationSpeed );
                    }
                });
                elements[2].addEventListener('click', function() {
                    if ( $('#rc2').height() != 148) {
                        console.log($('#rc2').height());
                        $('#rc2').animate({ height: 150 }, animationSpeed );
                        $('#result-img-container2').animate({ height: 150 }, animationSpeed );
                    } else {
                        console.log("hello");
                        $('#rc2').animate({ height: 225 }, animationSpeed );
                        $('#result-img-container2').animate({ height: 224 }, animationSpeed );
                    }
                });

                $('.cart').click(function() {
                    $.post("https://kzhe8vy1yd.execute-api.us-east-1.amazonaws.com/prod/TaskWS", JSON.stringify({

                        "type": "POST", 
                        "data": {
                            "TableName": "WineFoodShopping",
                            //New item information to be posted 
                            "Item": {
                                "Item": "CS160", 

                                }}}), 
                    function(data, status){
                    alert(status);
                    });






                    this.innerText = "ADDED TO CART";

                });


                // for(var i = 0; i < 3; i++) {
                //     elements[i].addEventListener('click', function() {
                //         if ( $('#rc' + i).height() != 148) {
                //             console.log($('#rc' + i).height());
                //             $('#rc' + i).animate({ height: 150 }, 1000 );
                //             $('#result-img-container' + i).animate({ height: 150 }, 1000 );
                //         } else {
                //             console.log("hello");
                //             $('#rc' + i).animate({ height: 225 }, 1000 );
                //             $('#result-img-container' + i).animate({ height: 224 }, 1000 );
                //         }                      
                //     });
                // }


                // $('label').click(function() {
                //     if ( $('.result-container').height() != 148) {
                //         console.log($('.result-container').height());
                //         $('.result-container').animate({ height: 150 }, 1000 );
                //         $('#result-img-container').animate({ height: 150 }, 1000 );
                //     } else {
                //         console.log("hello");
                //         $('.result-container').animate({ height: 225 }, 1000 );
                //         $('#result-img-container').animate({ height: 224 }, 1000 );
                //     }
                // });
            });
        </script>
        <script>

        // This function returns a tuple containing the pairing info
        // which is (Pair1Name, Pair1Image, Pair1Info)
        function findPairingInfo(pName, resList) {


            var listRes;
            $.post("https://kzhe8vy1yd.execute-api.us-east-1.amazonaws.com/prod/TaskWS", JSON.stringify({
            "type": "QUERY",
            "data": {
                "TableName": "WineFood",
                //Condition for item
                "FilterExpression": "#y = :y",
                //Variable for attribute name (think of key). You have to preface the variables with #
                "ExpressionAttributeNames": {
                    "#y": "Item",
                },
                //Variable for value to attribute. You have to preface the variables with :
                "ExpressionAttributeValues": {
                    ":y": pName
                }
            }

            }),
            //success callback
            function(data, status) {
                // console.log(pName)
                var data = JSON.parse(JSON.stringify(data))["Items"][0];

                // console.log(data)

                if (data == null) {
                    return null;
                }else if (data.length != 0) {
                    var rName = data["Item"];
                    var rImage = data["Picture"];
                    var rInfo = data["Info"];
                    console.log('good');     
                    listRes =  [rName, rImage, rInfo];
                    resList.push(listRes);
               
                } else {
                    return null;
                }



            }).fail(function(res) {
                console.log(res)
            })

            // console.log(listRes);
            return listRes;

        }

        function clickSearch() {
            

            var searchName = document.getElementById("bar").value;
            // console.log('gg');
            // console.log(searchName);
            var pList = "";

            $.post("https://kzhe8vy1yd.execute-api.us-east-1.amazonaws.com/prod/TaskWS", JSON.stringify({
                "type": "QUERY",
                "data": {
                    "TableName": "WineFood",
                    //Condition for item
                    "FilterExpression": "#y = :y",
                    //Variable for attribute name (think of key). You have to preface the variables with #
                    "ExpressionAttributeNames": {
                        "#y": "Item",
                    },
                    //Variable for value to attribute. You have to preface the variables with :
                    "ExpressionAttributeValues": {
                        ":y": searchName
                    }
                }
            }),
            //success callback
            function(data, status) {
                
                var data = JSON.parse(JSON.stringify(data))["Items"][0];
                // console.log(data);

                var targetName = data["Item"];
                var targetImage = data["Picture"];
                var targetInfo = data["Info"];
                var pairings = data["Pairings"];                
                // console.log(data["Items"][0]["Item"]);

                console.log('targerName:' + targetName);
                console.log('targetImage:' + targetImage);
                console.log('targetInfo:' + targetInfo);
                // console.log(pairings);
                // var targ


                pList = pairings.split(", ");
                // console.log(pList)

                var resList = [0]
                for (i=0; i<pList.length; i++) {
                    var curPair = findPairingInfo(pList[i], resList)
                    // console.log(curPair)
                    // if (curPair == null) {
                        

                    // } else {
                    //     console.log('gg');
                    //     resList.push(curPair);
                    // }
                }
                // resList = resList.slice(1, resList.length);
                console.log('Pairing Content List');
                console.log(resList);





                // Alan's code start here: to fill the content into the box
                // variable targetName: the name string of our search
                // varablle targetImage: the picture link of our search
                // varaible targetInfo: the description of our search
                // varaible resList: a list of tuples [(Pair1Name, Pair1Image, Pair1Info), (Pair2Name, Pair2Image, Pair2Info) ...]
                // ***Special Note*** Because of javascript issue, the actual content of the resList start from index 1 instead of index 0

            }).fail(function(res) {
                console.log(res)
            })
            
            // console.log(pList);

        }

        </script>
    </head>

    <body>
        <div class="site-wrapper">
            <div id="listModal" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">SHOPPING LIST</h3>
                        </div>
                        <div class="modal-body" id="sh_list_cont">
                            <div id="sh_list"></div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline-primary" data-dismiss="modal">CLOSE</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="resModal" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Steak</h3>
                        </div>
                        <div class="modal-body" id="results_list">
                            <div class="result-container" id="rc0">
                                <div class="result-contents" id="result-img-container0">
                                    <img id="result-img" src="http://biltmore.s3.amazonaws.com/1254/biltmoreestate-cabsauv.jpg"/>
                                </div>
                                <div class="result-contents" id="result-descrip-container">
                                <h4 id="result-descrip">Cabernet Sauvignon</h4>
                                <input class="toggles" id="toggle0" type="checkbox" unchecked>
                                <label for="toggle0"> Details</label>
                                <div class="expansions" id="expand0">
                                    <p><a class="cart" href="#">ADD TO CART</a></p>
                                    <p>Cabernet Sauvignon is a full-bodied wine with dark fruit flavors and savory tastes akin to peppers.</p>
                                </div>
                            </div>
                            </div>

                            <div class="result-container" id="rc1">
                                <div class="result-contents" id="result-img-container1">
                                    <img id="result-img" src="http://www.line39wines.com/media/8169/L39_PinotNoir_NV-HR.png"/>
                                </div>
                                <div class="result-contents" id="result-descrip-container">
                                    <h4 id="result-descrip">Pinot Noir</h4>
                                    <input class="toggles" id="toggle1" type="checkbox" unchecked>
                                    <label for="toggle1"> Details</label>
                                    <div class="expansions" id="expand1">
                                        <p><a class="cart" href="#">ADD TO CART</a></p>
                                        <p>Pinot Noir carries delicate and light floral flavors with a feel of silk and also contains supple tannins.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="result-container" id="rc2">
                                <div class="result-contents" id="result-img-container2">
                                    <img id="result-img" src="http://ei.isnooth.com/multimedia/0/5/c/image_94965.jpeg"/>
                                </div>
                                <div class="result-contents" id="result-descrip-container">
                                    <h4 id="result-descrip">Chardonnay</h4>
                                    <input class="toggles" id="toggle2" type="checkbox" unchecked>
                                    <label for="toggle2"> Details</label>
                                    <div class="expansions" id="expand2">
                                        <p><a class="cart" href="#">ADD TO CART</a></p>
                                        <p>Oaked Chardonnays are rich, full-bodied and have additional flavors of vanilla, butter and even caramel. </p>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline-primary" data-dismiss="modal">CLOSE</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <div id="actual">
                    <div id="navbar">
                        <span class="glyphicon glyphicon-shopping-cart" id="cart"></span>
                        <a href="add.html"><span class="glyphicon glyphicon-plus" id="add"></span></a>
                        <h2>SOMMELIER</h2>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"></div>
                        <div class="center-page">
                            <div  id="search" align="center">
                                <div class="input-group">
                                    <select name="choice" class="selectpicker form-control" style="width:170px;" data-live-search="true">
                                        <option value="food">pair food with</option>
                                        <option value="wine">pair wine with</option>
                                    </select>
                                    <input type="text" class="form-control" name="search" placeholder="searching..." id="bar">
                                    <span class="input-group-btn"><button class="btn btn-default" id="button" type="submit" onclick="clickSearch()">SEARCH</button></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2"></div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12" id="pop_name">>>> POPULAR PAIRINGS <<<</div>
                    </div>

                    <div class="row" id="popular">
                        <div class="col-sm-2">
                            <div class="tile" id="one">
                                <div class="filter">
                                    <p>steak<br />
                                    +<br />
                                    cabernet sauvignon<br /></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="tile" id="two">
                                <div class="filter">
                                    halibut<br />
                                    +<br />
                                    chardonnay<br />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="tile" id="three">
                                <div class="filter">
                                    crab<br />
                                    +<br />
                                    pinot noir<br />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="tile" id="four">
                                <div class="filter">
                                    lamb<br />
                                    +<br />
                                    sauvignon blanc<br />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="tile" id="five">
                                <div class="filter">
                                    shrimp<br />
                                    +<br />
                                    vinho verde<br />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="tile" id="six">
                                <div class="filter">
                                    duck<br />
                                    +<br />
                                    beaujolais<br />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <div id="footer">© TEAM SANS. CS160 SPRING 2017. ALL RIGHTS RESERVED.</div>
                        </div>
                    </div>
                </div>

                <div id="landing">
                    <div class="row" id="logo">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-8" id="title">
                            <h1>SOM<br />
                                MEL<br />
                                IER
                            </h1>
                        </div>
                        <div class="col-sm-2"></div>
                    </div>
                </div>                

            </div>
        </div>
    </body>
</html>
